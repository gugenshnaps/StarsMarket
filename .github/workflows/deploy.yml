name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main
      - master

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Check secrets
        run: |
          echo "Checking TELEGRAM_BOT_TOKEN length: ${#TELEGRAM_BOT_TOKEN}"
          echo "Checking TELEGRAM_CHANNEL_ID length: ${#TELEGRAM_CHANNEL_ID}"
          echo "First 5 chars of bot token: ${TELEGRAM_BOT_TOKEN:0:5}"
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}

      - name: Create config.js
        run: |
          cat > config.js << EOL
          window.CONFIG = {
            TELEGRAM_BOT_TOKEN: "${{ secrets.TELEGRAM_BOT_TOKEN }}",
            TELEGRAM_CHANNEL_ID: "${{ secrets.TELEGRAM_CHANNEL_ID }}",
            API_URL: "https://api.telegram.org/bot"
          };
          EOL
          
          echo "config.js created successfully"

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: .
          clean: true
